/**!
 * FooNav - A jQuery navigation menu.
 * @version 0.0.1
 * @link TODO
 * @copyright Steven Usher & Brad Vincent 2014
 * @license Released under the MIT license.
 * You are free to use FooNav jQuery in personal projects (excluding WordPress plugins and themes) as long as this copyright header is left intact.
 * Restriction 1: you may not create a WordPress plugin that bundles FooNav jQuery (rather use TODO).
 * Restriction 2: you may only bundle FooNav jQuery within a WordPress theme if you have a developer license.
 */
(function(n,o){o.FooNav={defaults:{after:null,before:null,buttons:null,classes:null,icons:{back:{family:"fon-icon",icon:"fon-icon-back"},expand:{family:"fon-icon",icon:"fon-icon-expand"},home:{family:"fon-icon",icon:"fon-icon-home"},menu:{family:"fon-icon",icon:"fon-icon-menu"},top:{family:"fon-icon",icon:"fon-icon-top"}},items:"body",position:"fon-top-right",theme:"fon-light",title:"FooNav",top:!0,transition:"slide",scroll:0,speed:200,smart:{enable:!0,anchors:!0,close:!0,open:!1,remember:!0,scroll:!0,url:!0}},instances:[]},jQuery.Event.prototype.allow=!1,FooNav.fetch=function(n){return n=n>FooNav.instances.length-1?FooNav.instances.length-1:0>n?0:n,FooNav.instances[n]},FooNav.init=function(n){return new FooNav.Instance(n)},FooNav.reinit=function(n,o){FooNav.fetch(n).reinit(o)},FooNav.destroy=function(n){FooNav.fetch(n).destroy()},FooNav.destroyAll=function(){for(var n=0;FooNav.instances.length>n;n++){var o=FooNav.instances[n];null!=o&&o.destroy()}},FooNav.items=function(o,t){function e(o){for(var t=0;l.length>t;t++)if(n(o).is(l[t]))return t;return-1}function s(n){for(var o=[],t=0;n>t;t++)o.push(l[t]);return o.join(",")}function i(n,o){for(var t=0;o.length>t;t++){if(o[t].href=="#"+n)return o[t];if(o[t].children){var e=i(n,o[t].children);if(null!=e)return e}}return null}function a(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}o=o||"body",t=t||"h1,h2,h3,h4,h5,h6";var r=[],l=t.split(","),c=null,f=null,u=null,p=null,d=null;return n(o).find(t).each(function(){if(f=this,d=n(f),(""==f.id||null==f.id)&&(f.id=a()),c={text:d.text(),href:"#"+f.id},p=s(e(f)),null!=p&&""!=p)if(u=d.prevAll(p).first(),u.length>0){var o=i(u.attr("id"),r);null!=o?(o.children=o.children||[],o.children.push(c)):r.push(c)}else r.push(c);else r.push(c)}),r},FooNav.Timer=function(){this.id=null;var n=this;return this.start=function(o,t){n.stop(),n.id=setTimeout(function(){n.id=null,o()},t)},this.stop=function(){null!=n.id&&(clearTimeout(n.id),n.id=null)},this},FooNav.Instance=function(t){this.id=FooNav.instances.push(this),this.index=this.id-1,this.o=n.extend(!0,{},FooNav.defaults),this.nav=null,this.inner=null,this.buttons=null,this.back=null,this.top=null,this.toggle=null,this.menu=null;var e=this,s=function(){};return this.init=function(t){return e.o=n.extend(!0,e.o,t),e.b.items(),e.b.nav(),e.b.buttons(),e.b.menu(),e.b.extra(),e.m.position(!1),e.o.smart.enable&&(e.o.smart.url&&e.m.set(location.href,e.o.smart.open),e.o.smart.close&&n(o).on("click",e.w.clicked),e.o.smart.anchors&&n(o).on("scroll",e.a.check)),n(o).on("scroll",e.w.scrolled),0!=e.o.scroll?e:(e.nav.show(),e)},this.reinit=function(n){e.destroy(!0),e.init(n)},this.destroy=function(t){t=t||!1,e.nav.remove(),e.o=n.extend(!0,{},FooNav.defaults),e.nav=e.inner=e.back=e.top=e.toggle=e.menu=null,n(o).off("scroll",e.a.check).off("scroll",e.w.scrolled).off("click",e.w.clicked),t||(FooNav.instances[e.index]=null)},this.toggle=function(){e.m.toggle({allow:!0})},this.u={_a:document.createElement("a"),qualify:function(n){return e.u._a.href=n,e.u._a.href},isCurrent:function(n){return e.u.qualify(n)==[location.protocol,"//",location.host,location.pathname].join("")},concat:function(){return Array.prototype.slice.call(arguments).join(" ")},position:function(){var n=e.o.position.split("-");return{v:n[1],h:n[2]}},exists:function(o,t,e){if(t=t||s,e=e||s,"string"==typeof o&&"#"==o.substring(0,1)){var i=n(o);return i.length>0?(t(i),!0):(e(),!1)}return e(),!1},_supportsTransitions:null,supportsTransitions:function(){if(null!=e.u._supportsTransitions)return e.u._supportsTransitions;var n,o=document.body||document.documentElement,t=o.style,s="transition";if("string"==typeof t[s])return!0;n=["Moz","Webkit","Khtml","O","ms"],s=s.charAt(0).toUpperCase()+s.substr(1);for(var i=0;n.length>i;i++)if("string"==typeof t[n[i]+s])return e.u._supportsTransitions=!0;return e.u._supportsTransitions=!1}},this.b={items:function(){if(!n.isArray(e.o.items)){var o=typeof e.o.items;"string"==o?e.o.items=FooNav.items(e.o.items):"object"==o&&(e.o.items=FooNav.items(e.o.items.container,e.o.items.selector))}},nav:function(){e.nav=n("<div></div>",{"class":e.u.concat("fon-nav",e.o.position,e.o.theme,e.o.classes),css:{display:"none"}}).on("click",".fon-item-link",e.m.clicked).on("click",".fon-item-back",e.m.back).appendTo("body")},buttons:function(){function o(o){var t=e.o.icons[o];return t?n("<span></span>",{"class":e.u.concat("fon-button-icon",t.family,t.icon)}):n()}if(e.buttons=n("<div></div>",{"class":"fon-buttons"}).appendTo(e.nav),e.top=n("<a></a>",{"class":"fon-button fon-button-top",href:"#top",on:{click:e.w.top}}).append(o("top")).appendTo(e.buttons),e.toggle=n("<a></a>",{"class":"fon-button",href:"#toggle",on:{click:e.m.toggle}}).append(o("menu")).appendTo(e.buttons),"object"==typeof e.o.buttons)for(var t in e.o.buttons)if(e.o.buttons.hasOwnProperty(t)&&e.o.icons.hasOwnProperty(t)){var s=e.o.buttons[t];if("string"==typeof s){if("home"==t&&e.u.isCurrent(s))continue;n("<a></a>",{"class":"fon-button",href:s}).append(o(t)).appendTo(e.buttons)}else if("object"==typeof s){if("string"!=typeof s.href||"home"==t&&e.u.isCurrent(s.href))continue;s["class"]="string"==typeof s["class"]?e.u.concat("fon-button",s["class"]):"fon-button",n("<a></a>",s).append(o(t)).appendTo(e.buttons)}}var i=e.toggle.outerHeight()*e.buttons.children().length,a=parseInt(e.buttons.css("top"),0),r=parseInt(e.buttons.css("bottom"),0),l=isNaN(a)?isNaN(r)?0:r:a;e.nav.css("min-height",i+l)},menu:function(){function o(o){var t=e.o.icons[o];return t?n("<span></span>",{"class":e.u.concat("fon-item-icon",t.family,t.icon)}):n()}function t(s,i,a){var r,l,c,f,u,p=a.length;for(null!=i?(c=n("<li></li>").appendTo(s),f=n("<a></a>",{"class":"fon-item fon-item-back",href:i.href,text:i.text}).prepend(o("back")).appendTo(c),e.u.exists(i.href)&&f.addClass("fon-anchored")):"string"==typeof e.o.title&&(c=n("<li></li>").appendTo(s),f=n("<span></span>",{"class":"fon-item fon-item-title fon-anchored",text:e.o.title}).appendTo(c)),r=0;p>r;r++)u=a[r],c=n("<li></li>").appendTo(s),f=n("<a></a>",{"class":"fon-item fon-item-link",href:u.href,text:u.text}).appendTo(c),e.u.exists(u.href)&&f.addClass("fon-anchored"),n.isArray(u.children)&&(f.addClass("fon-has-menu").prepend(o("expand")),l=n("<ul></ul>",{"class":"fon-menu"}).appendTo(c),t(l,u,u.children))}e.inner=n("<div></div>",{"class":"fon-nav-inner"}).appendTo(e.nav),e.menu=n("<ul></ul>",{"class":"fon-menu"}),t(e.menu,null,e.o.items),e.inner.append(e.menu.clone())},extra:function(){null!=e.o.before&&e.nav.prepend(n("<div></div>",{"class":"fon-before"}).append(e.o.before)),null!=e.o.after&&e.nav.append(n("<div></div>",{"class":"fon-after"}).append(e.o.after))}},this.m={position:function(n){n=n||!1;var o=e.u.position();n?(e.nav.css(o.h,0),e.nav.removeClass("fon-closed fon-user-closed").addClass("fon-open")):(e.nav.css(o.h,-e.nav.outerWidth(!0)),e.nav.removeClass("fon-open").addClass("fon-closed"))},exists:function(o,t,s){if(t=t||e.menu,s=s||!1,null==o&&s)return t.find("li > .fon-item-title").first();if(o=e.u.qualify(o),s){var i=t.find("li > .fon-item-back").filter(function(){return o==e.u.qualify(n(this).attr("href"))}).first();if(i.length>0)return i}return t.find("li > .fon-item-link").filter(function(){return o==e.u.qualify(n(this).attr("href"))}).first()},active:function(n,o,t){t=t||!1,o.find("li > .fon-active").removeClass("fon-active");var s=e.m.exists(n,o,t);0!=s.length&&s.addClass("fon-active")},size:function(o){var t=n(".fon-nav-size");0==t.length&&(t=n("<div></div>",{"class":"fon-nav-size"}).appendTo("body"),n("<div></div>",{"class":"fon-nav-inner"}).appendTo(t)),t.removeClass().addClass(e.u.concat("fon-nav-size",e.o.theme,e.o.classes,e.o.position));var s=t.find(".fon-nav-inner").empty().append(o.clone());return{height:s.height(),width:s.width()}},get:function(n,o){return"string"==typeof n?e.m.exists(n,e.menu,o).closest(".fon-menu").clone():e.menu.clone()},set:function(n,o){o=o||!1;var t=e.m.get(n,!0);if(0!=t.length){var s=e.m.size(t);e.inner.empty().css(s).append(t),e.m.active(n,t,!0),e.m.position(o)}},transition:function(n,o,t,i){i=i||s;var a,r=e.m.size(o),l={height:e.inner.height(),width:e.inner.width()},c=r.width!=l.width||r.height!=l.height?e.o.speed:0,f={},u={},p={},d={};switch(e.o.transition){case"fade":a="opacity",f[a]=u[a]=0,p[a]=1,d[a]="";break;default:a="left",f[a]=t?l.width:-l.width,u[a]=t?-l.width:l.width,p[a]=0,d[a]=""}e.inner.stop(),n.stop().animate(f,e.o.speed,function(){n.remove(),e.inner.animate(r,c,function(){e.inner.empty().append(o.css(u)),o.animate(p,e.o.speed,function(){o.css(d),i()})})})},toggle:function(n){n.allow||(n.preventDefault(),n.stopPropagation()),e.nav.toggleClass("fon-open");var o=e.nav.outerWidth(!0),t=e.nav.hasClass("fon-open"),s=e.u.position(),i=0,a=0,r={};t?i=-o:a=-o,r[s.h]=a,t?e.nav.removeClass("fon-closed fon-user-closed"):e.nav.addClass("fon-closing"),e.nav.css(s.h,i).animate(r,e.o.speed,function(){if(!t&&null!=e.nav){if(e.o.smart.enable&&!e.o.smart.remember){var n=e.menu.clone(),o=e.m.size(n);e.inner.empty().css(o).append(n),e.m.position(!1)}e.nav.removeClass("fon-closing").addClass("fon-closed fon-user-closed")}})},back:function(o){var t=n(this),s=t.attr("href"),i=e.inner.find("> .fon-menu:last"),a=e.m.get(s),r=t.hasClass("fon-anchored");e.m.transition(i,a,!0,function(){e.m.active(s,a)}),r&&e.o.smart.enable&&e.o.smart.scroll&&(o.preventDefault(),o.stopPropagation(),e.w.scroll(s))},clicked:function(o){var t=n(this),s=t.hasClass("fon-anchored"),i=t.hasClass("fon-has-menu"),a=t.attr("href");if(t.parents(".fon-menu:first").find("li > .fon-active").removeClass("fon-active"),t.addClass("fon-active"),i){var r=e.inner.find("> .fon-menu:last"),l=e.m.get(a,!0);e.m.transition(r,l,!1,function(){e.m.active(a,l,!0)})}s&&e.o.smart.enable&&e.o.smart.scroll?(o.preventDefault(),o.stopPropagation(),e.w.scroll(a)):"#"==a.substring(0,1)&&e.o.smart.enable&&e.o.smart.scroll&&(o.preventDefault(),o.stopPropagation())}},this.a={_check:new FooNav.Timer,tracked:{elements:[],build:function(o){var t,s;for(t=0;o.length>t;t++)if(s=o[t],n.isArray(s.children)&&e.a.tracked.build(s.children),"string"==typeof s.href&&"#"==s.href.substring(0,1)){var i=n(s.href);if(0==i.length)continue;e.a.tracked.elements.push(i.addClass("fon-tracked"))}},get:function(){return e.a.tracked.elements.length>0?e.a.tracked.elements:(e.a.tracked.elements=[],e.a.tracked.build(e.o.items),e.a.tracked.elements)}},visible:function(n){var o=n.getBoundingClientRect(),t=20;return o.top>=-t&&o.left>=-t},check:function(){e.a._check.start(function(){var t=n(o).scrollTop();if(e.o.scroll>=t)e.m.set(null,e.nav.hasClass("fon-open"));else{var s,i,a,r,l=e.a.tracked.get(),c=[],f=0,u=n();for(s=0;l.length>s;s++)e.a.visible(l[s].get(0))&&c.push(l[s]);for(s=0;c.length>s;s++)i=c[s],a=i.offset(),(0==f||f>a.top)&&(f=a.top,u=i);if(0==u.length)return;r=u.attr("id"),e.m.set("#"+r,e.nav.hasClass("fon-open")||!e.nav.hasClass("fon-user-closed")&&e.o.smart.open)}},100)}},this.w={_scroll:new FooNav.Timer,_scrolled:new FooNav.Timer,scroll:function(t){e.a._check.stop();var s=n(t),i=s.offset().top;n(o).off("scroll",e.a.check),e.w._scroll.stop(),n("html, body").stop().animate({scrollTop:i},800,function(){e.w._scroll.start(function(){e.w._to=null,n(o).on("scroll",e.a.check)},100)}),e.o.smart.enable&&e.o.smart.scroll},scrolled:function(){e.w._scrolled.start(function(){var t=n(o).scrollTop();e.o.top&&(t>0?e.top.addClass("fon-show"):e.top.removeClass("fon-show"),e.u.supportsTransitions()||(t>0?e.top.slideDown(500):e.top.slideUp(500))),0!=e.o.scroll&&(t>e.o.scroll?e.nav.fadeIn(e.o.speed):e.nav.fadeOut(e.o.speed))},100)},clicked:function(o){!e.nav.hasClass("fon-open")||e.nav.hasClass("fon-closing")||n(o.target).is("fon-nav")||0!=n(o.target).closest(".fon-nav").length||(o.allow=!0,e.m.toggle.call(e.toggle.get(0),o))},top:function(o){o.preventDefault(),o.stopPropagation(),e.o.smart.enable&&e.o.smart.scroll?n("html, body").stop().animate({scrollTop:0},1e3):n("html, body").scrollTop(0)}},this.init(t)}})(jQuery,window);