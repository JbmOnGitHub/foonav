/**!
 * FooNav - A jQuery navigation menu.
 * @version 0.0.1
 * @link http://fooplugins.github.io/foonav/
 * @copyright Steven Usher & Brad Vincent 2014
 * @license Released under the MIT license.
 */
(function(n,t){t.FooNav={defaults:{after:null,before:null,buttons:null,classes:null,deeplinking:!1,icons:{back:{family:"fon-icon",icon:"fon-icon-back"},expand:{family:"fon-icon",icon:"fon-icon-expand"},home:{family:"fon-icon",icon:"fon-icon-home"},menu:{family:"fon-icon",icon:"fon-icon-menu"},top:{family:"fon-icon",icon:"fon-icon-top"}},items:"body",position:"fon-top-right",theme:"fon-light",title:null,top:!0,transition:"slide",scroll:0,speed:200,smart:{enable:!0,anchors:!0,close:!0,open:!1,remember:!0,scroll:!0,url:!0}},instances:[]},jQuery.Event.prototype.allow=!1,FooNav.fetch=function(n){return n=n>FooNav.instances.length-1?FooNav.instances.length-1:0>n?0:n,FooNav.instances[n]},FooNav.init=function(n){return new FooNav.Instance(n)},FooNav.reinit=function(n,t){FooNav.fetch(n).reinit(t)},FooNav.destroy=function(n){FooNav.fetch(n).destroy()},FooNav.destroyAll=function(){for(var n=0;FooNav.instances.length>n;n++){var t=FooNav.instances[n];null!=t&&t.destroy()}},FooNav.items=function(t,o){function e(t){for(var o=0;r.length>o;o++)if(n(t).is(r[o]))return o;return-1}function s(n){for(var t=[],o=0;n>o;o++)t.push(r[o]);return t.join(",")}function i(n,t){for(var o=0;t.length>o;o++){if(t[o].href=="#"+n)return t[o];if(t[o].children){var e=i(n,t[o].children);if(null!=e)return e}}return null}function a(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}t=t||"body",o=o||"h1,h2,h3,h4,h5,h6";var l=[],r=o.split(","),c=null,f=null,u=null,p=null,d=null;return n(t).find(o).each(function(){if(f=this,d=n(f),(""==f.id||null==f.id)&&(f.id=a()),c={text:d.text(),href:"#"+f.id},p=s(e(f)),null!=p&&""!=p)if(u=d.prevAll(p).first(),u.length>0){var t=i(u.attr("id"),l);null!=t?(t.children=t.children||[],t.children.push(c)):l.push(c)}else l.push(c);else l.push(c)}),l},FooNav.Timer=function(){this.id=null;var n=this;return this.start=function(t,o){n.stop(),n.id=setTimeout(function(){n.id=null,t()},o)},this.stop=function(){null!=n.id&&(clearTimeout(n.id),n.id=null)},this},FooNav.Instance=function(o){this.id=FooNav.instances.push(this),this.index=this.id-1,this.o=n.extend(!0,{},FooNav.defaults),this.nav=null,this.inner=null,this.buttons=null,this.back=null,this.top=null,this.toggle=null,this.menu=null;var e=this,s=function(){};return this.init=function(o){return e.o=n.extend(!0,e.o,o),e.b.items(),e.b.nav(),e.b.buttons(),e.b.menu(),e.b.extra(),e.o.smart.enable&&(e.o.smart.url&&e.m.set(location.href,e.o.smart.open),e.o.smart.close&&n(t).on("click",e.w.clicked),e.o.smart.anchors&&n(t).on("scroll",e.a.check)),n(t).on("scroll",e.w.scrolled),setTimeout(function(){e.m.position(!1)},500),0!=e.o.scroll?e:(e.nav.show(),e)},this.reinit=function(n){e.destroy(!0),e.init(n)},this.destroy=function(o){o=o||!1,e.nav.remove(),e.o=n.extend(!0,{},FooNav.defaults),e.nav=e.inner=e.back=e.top=e.toggle=e.menu=null,n(t).off("scroll",e.a.check).off("scroll",e.w.scrolled).off("click",e.w.clicked),o||(FooNav.instances[e.index]=null)},this.toggle=function(){e.m.toggle({allow:!0})},this.u={_a:document.createElement("a"),qualify:function(n){return e.u._a.href=n,e.u._a.href},isCurrent:function(n){return e.u.qualify(n)==[location.protocol,"//",location.host,location.pathname].join("")},concat:function(){return Array.prototype.slice.call(arguments).join(" ")},position:function(){var n=e.o.position.split("-");return{v:n[1],h:n[2]}},exists:function(t,o,e){if(o=o||s,e=e||s,"string"==typeof t&&"#"==t.substring(0,1)){var i=n(t);return i.length>0?(o(i),!0):(e(),!1)}return e(),!1},_supportsTransitions:null,supportsTransitions:function(){if(null!=e.u._supportsTransitions)return e.u._supportsTransitions;var n,t=document.body||document.documentElement,o=t.style,s="transition";if("string"==typeof o[s])return!0;n=["Moz","Webkit","Khtml","O","ms"],s=s.charAt(0).toUpperCase()+s.substr(1);for(var i=0;n.length>i;i++)if("string"==typeof o[n[i]+s])return e.u._supportsTransitions=!0;return e.u._supportsTransitions=!1}},this.b={items:function(){if(!n.isArray(e.o.items)){var t=typeof e.o.items;"string"==t?e.o.items=FooNav.items(e.o.items):"object"==t&&(e.o.items=FooNav.items(e.o.items.container,e.o.items.selector))}},nav:function(){e.nav=n("<div></div>",{"class":e.u.concat("fon-nav",e.o.position,e.o.theme,e.o.classes),css:{display:"none"}}).on("click",".fon-item-link",e.m.clicked).on("click",".fon-item-back",e.m.back).appendTo("body")},buttons:function(){function t(t){var o=e.o.icons[t];return o?n("<span></span>",{"class":e.u.concat("fon-button-icon",o.family,o.icon)}):n()}if(e.buttons=n("<div></div>",{"class":"fon-buttons"}).appendTo(e.nav),e.top=n("<a></a>",{"class":"fon-button fon-button-top",href:"#top",on:{click:e.w.top}}).append(t("top")).appendTo(e.buttons),e.toggle=n("<a></a>",{"class":"fon-button",href:"#toggle",on:{click:e.m.toggle}}).append(t("menu")).appendTo(e.buttons),"object"==typeof e.o.buttons)for(var o in e.o.buttons)if(e.o.buttons.hasOwnProperty(o)&&e.o.icons.hasOwnProperty(o)){var s=e.o.buttons[o];if("string"==typeof s){if("home"==o&&e.u.isCurrent(s))continue;n("<a></a>",{"class":"fon-button",href:s}).append(t(o)).appendTo(e.buttons)}else if("object"==typeof s){if("string"!=typeof s.href||"home"==o&&e.u.isCurrent(s.href))continue;s["class"]="string"==typeof s["class"]?e.u.concat("fon-button",s["class"]):"fon-button",n("<a></a>",s).append(t(o)).appendTo(e.buttons)}}var i=e.toggle.outerHeight()*e.buttons.children().length,a=parseInt(e.buttons.css("top"),0),l=parseInt(e.buttons.css("bottom"),0),r=isNaN(a)?isNaN(l)?0:l:a;e.nav.css("min-height",i+r)},menu:function(){function t(t){var o=e.o.icons[t];return o?n("<span></span>",{"class":e.u.concat("fon-item-icon",o.family,o.icon)}):n()}function o(s,i,a){var l,r,c,f,u,p=a.length;for(null!=i?(c=n("<li></li>").appendTo(s),f=n("<a></a>",{"class":"fon-item fon-item-back",href:i.href,text:i.text}).prepend(t("back")).appendTo(c),e.u.exists(i.href)&&f.addClass("fon-anchored")):"string"==typeof e.o.title&&(c=n("<li></li>").appendTo(s),f=n("<span></span>",{"class":"fon-item fon-item-title fon-anchored",text:e.o.title}).appendTo(c)),l=0;p>l;l++)u=a[l],c=n("<li></li>").appendTo(s),f=n("<a></a>",{"class":"fon-item fon-item-link",href:u.href,text:u.text}).appendTo(c),e.u.exists(u.href)&&f.addClass("fon-anchored"),n.isArray(u.children)&&(f.addClass("fon-has-menu").prepend(t("expand")),r=n("<ul></ul>",{"class":"fon-menu"}).appendTo(c),o(r,u,u.children))}e.inner=n("<div></div>",{"class":"fon-nav-inner"}).appendTo(e.nav),e.menu=n("<ul></ul>",{"class":"fon-menu"}),o(e.menu,null,e.o.items),e.inner.append(e.menu.clone())},extra:function(){null!=e.o.before&&e.nav.prepend(n("<div></div>",{"class":"fon-before"}).append(e.o.before)),null!=e.o.after&&e.nav.append(n("<div></div>",{"class":"fon-after"}).append(e.o.after))}},this.m={position:function(n){n=n||!1;var t=e.u.position();n?(e.nav.css(t.h,0),e.nav.removeClass("fon-closed fon-user-closed").addClass("fon-open")):(e.nav.css(t.h,-e.nav.outerWidth(!0)),e.nav.removeClass("fon-open").addClass("fon-closed"))},exists:function(t,o,s){if(o=o||e.menu,s=s||!1,null==t&&s)return o.find("li > .fon-item-title").first();if(t=e.u.qualify(t),s){var i=o.find("li > .fon-item-back").filter(function(){return t==e.u.qualify(n(this).attr("href"))}).first();if(i.length>0)return i}return o.find("li > .fon-item-link").filter(function(){return t==e.u.qualify(n(this).attr("href"))}).first()},active:function(n,t,o){o=o||!1,t.find("li > .fon-active").removeClass("fon-active");var s=e.m.exists(n,t,o);0!=s.length&&s.addClass("fon-active")},size:function(t){var o=n(".fon-nav-size");0==o.length&&(o=n("<div></div>",{"class":"fon-nav-size"}).appendTo("body"),n("<div></div>",{"class":"fon-nav-inner"}).appendTo(o)),o.removeClass().addClass(e.u.concat("fon-nav-size",e.o.theme,e.o.classes,e.o.position));var s=o.find(".fon-nav-inner").empty().append(t.clone());return{height:s.height(),width:s.width()}},get:function(n,t){return"string"==typeof n?e.m.exists(n,e.menu,t).closest(".fon-menu").clone():e.menu.clone()},set:function(n,t){t=t||!1;var o=e.m.get(n,!0);if(0!=o.length){var s=e.m.size(o);e.inner.empty().css(s).append(o),e.m.active(n,o,!0),e.m.position(t)}},transition:function(n,t,o,i){i=i||s;var a,l=e.m.size(t),r={height:e.inner.height(),width:e.inner.width()},c=l.width!=r.width||l.height!=r.height?e.o.speed:0,f={},u={},p={},d={};switch(e.o.transition){case"fade":a="opacity",f[a]=u[a]=0,p[a]=1,d[a]="";break;default:a="left",f[a]=o?r.width:-r.width,u[a]=o?-r.width:r.width,p[a]=0,d[a]=""}e.inner.stop(),n.stop().animate(f,e.o.speed,function(){n.remove(),e.inner.animate(l,c,function(){e.inner.empty().append(t.css(u)),t.animate(p,e.o.speed,function(){t.css(d),i()})})})},toggle:function(n){n.allow||(n.preventDefault(),n.stopPropagation()),e.nav.toggleClass("fon-open");var t=e.nav.outerWidth(!0),o=e.nav.hasClass("fon-open"),s=e.u.position(),i=0,a=0,l={};o?i=-t:a=-t,l[s.h]=a,o?e.nav.removeClass("fon-closed fon-user-closed"):e.nav.addClass("fon-closing"),e.nav.css(s.h,i).animate(l,e.o.speed,function(){if(!o&&null!=e.nav){if(e.o.smart.enable&&!e.o.smart.remember){var n=e.menu.clone(),t=e.m.size(n);e.inner.empty().css(t).append(n),e.m.position(!1)}e.nav.removeClass("fon-closing").addClass("fon-closed fon-user-closed")}})},back:function(t){var o=n(this),s=o.attr("href"),i=e.inner.find("> .fon-menu:last"),a=e.m.get(s),l=o.hasClass("fon-anchored");e.m.transition(i,a,!0,function(){e.m.active(s,a)}),l&&e.o.smart.enable&&e.o.smart.scroll&&(t.preventDefault(),t.stopPropagation(),e.w.scroll(s),e.d.set(s.substring(1,s.length)))},clicked:function(t){var o=n(this),s=o.hasClass("fon-anchored"),i=o.hasClass("fon-has-menu"),a=o.attr("href");if(o.parents(".fon-menu:first").find("li > .fon-active").removeClass("fon-active"),o.addClass("fon-active"),i){var l=e.inner.find("> .fon-menu:last"),r=e.m.get(a,!0);e.m.transition(l,r,!1,function(){e.m.active(a,r,!0)})}s&&e.o.smart.enable&&e.o.smart.scroll?(t.preventDefault(),t.stopPropagation(),e.w.scroll(a),e.d.set(a.substring(1,a.length))):"#"==a.substring(0,1)&&e.o.smart.enable&&e.o.smart.scroll&&(t.preventDefault(),t.stopPropagation())}},this.d={set:function(n){e.o.deeplinking&&(t.history&&t.history.pushState?t.history.replaceState(null,document.title,t.location.pathname+"#"+n):t.location.replace((""+t.location).split("#")[0]+"#"+n))},clear:function(){e.o.deeplinking&&(t.history&&t.history.pushState?t.history.replaceState(null,document.title,t.location.pathname):t.location.replace((""+t.location).split("#")[0]+"#/"))}},this.a={_check:new FooNav.Timer,tracked:{elements:[],build:function(t){var o,s;for(o=0;t.length>o;o++)if(s=t[o],n.isArray(s.children)&&e.a.tracked.build(s.children),"string"==typeof s.href&&"#"==s.href.substring(0,1)){var i=n(s.href);if(0==i.length)continue;e.a.tracked.elements.push(i.addClass("fon-tracked"))}},get:function(){return e.a.tracked.elements.length>0?e.a.tracked.elements:(e.a.tracked.elements=[],e.a.tracked.build(e.o.items),e.a.tracked.elements)}},visible:function(n){var t=n.getBoundingClientRect(),o=20;return t.top>=-o&&t.left>=-o},check:function(){e.a._check.start(function(){var o=n(t).scrollTop();if(e.o.scroll>=o)e.m.set(null,e.nav.hasClass("fon-open"));else{var s,i,a,l,r=e.a.tracked.get(),c=[],f=0,u=n();for(s=0;r.length>s;s++)e.a.visible(r[s].get(0))&&c.push(r[s]);for(s=0;c.length>s;s++)i=c[s],a=i.offset(),(0==f||f>a.top)&&(f=a.top,u=i);if(0==u.length)return;l=u.attr("id"),e.m.set("#"+l,e.nav.hasClass("fon-open")||!e.nav.hasClass("fon-user-closed")&&e.o.smart.open),e.d.set(l)}},100)}},this.w={_scroll:new FooNav.Timer,_scrolled:new FooNav.Timer,scroll:function(o){e.a._check.stop();var s=n(o),i=s.offset().top;n(t).off("scroll",e.a.check),e.w._scroll.stop(),n("html, body").stop().animate({scrollTop:i},800,function(){e.w._scroll.start(function(){e.w._to=null,n(t).on("scroll",e.a.check)},100)}),e.o.smart.enable&&e.o.smart.scroll},scrolled:function(){e.w._scrolled.start(function(){var o=n(t).scrollTop();e.o.top&&(o>0?e.top.addClass("fon-show"):e.top.removeClass("fon-show"),e.u.supportsTransitions()||(o>0?e.top.slideDown(500):e.top.slideUp(500))),0!=e.o.scroll&&(o>e.o.scroll?e.nav.fadeIn(e.o.speed):e.nav.fadeOut(e.o.speed))},100)},clicked:function(t){!e.nav.hasClass("fon-open")||e.nav.hasClass("fon-closing")||n(t.target).is("fon-nav")||0!=n(t.target).closest(".fon-nav").length||(t.allow=!0,e.m.toggle.call(e.toggle.get(0),t))},top:function(t){t.preventDefault(),t.stopPropagation(),e.o.smart.enable&&e.o.smart.scroll?n("html, body").stop().animate({scrollTop:0},1e3):n("html, body").scrollTop(0)}},this.init(o)}})(jQuery,window);